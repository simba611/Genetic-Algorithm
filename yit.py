from client import get_errors, API_ENDPOINT, MAX_DEG
from config import *
import random
import time
from mutation import *
from sex import *
import numpy as np

random.seed(time.time())

Generation = []

new = []



############# generate first generation
# for i in range(0,GENERATION_SIZE):
#     new.append(mutation_generation_first())
#     err = get_errors(SECRET_KEY_ID, new[i])
#     Generation.append([new[i], err[0], err[1], FITNESS_FACTOR*err[0]+err[1]])
# # print(new)
Generation = [[[-8.97769704790955e-09, -6.370928494538193e-15, 6.3091796157393e-16, 4.2989600545493845e-11, -1.1225911616062575e-10, -1.0735938968561053e-17, 1.1515647845602457e-16, 1.180897115558082e-05, -1.2102441622715134e-06, -6.4402152280298505e-09, 4.96174897735787e-10], 54629679229.86228, 41377172390.22862, 4.696472247768344e+21], [[-8.735276414705629e-10, -3.537948435022503e-14, 1.8967373252414958e-15, 4.131998605160493e-12, -2.3423906672684947e-10, -8.985632728821394e-18, 1.5717037312781008e-16, 1.4547277826514632e-05, -1.2364048678897479e-06, -8.248041814156978e-09, 5.154965685116909e-10], 68815048067.86612, 18085954076.160164, 5.062612575427698e+21], [[-8.260102637895015e-09, -1.1148216036451528e-14, 1.275558468302675e-15, 5.263349451751397e-11, -1.2123957409138372e-10, -3.714694116587492e-18, 1.7405967588341513e-16, 1.2170364807118342e-05, -1.1846104581064387e-06, -7.184097317781436e-09, 4.95560473924634e-10], 73230617375.5099, 28072874142.608772, 6.150809583825085e+21], [[0.0, -2.5284726159004153e-14, 1.7801748026899197e-15, 2.9889658956997054e-11, -1.7490232253263413e-10, -7.343144622651264e-18, 4.1017000342486986e-16, 1.2180516539498898e-05, -1.1822975264574355e-06, -7.183829721087023e-09, 4.933642307317599e-10], 76463090966.7114, 22231760825.434082, 6.340855469582888e+21], [[1.673485178714863e-10, -2.7956523337169036e-14, 2.0475078188424042e-15, 2.3099467483974604e-12, -2.48460870773449e-10, -8.518577718635537e-18, 4.389544399993234e-16, 1.4833505181177952e-05, -1.2437359018696523e-06, -8.433663442895818e-09, 5.180788635034896e-10], 79007560098.79794, 20670186121.885338, 6.66945114707855e+21], [[-1.876981286552379e-08, -4.942482967767194e-15, 9.205984400873952e-16, 4.373776564598084e-11, -8.986163037696444e-11, -1.8065590705776407e-17, 1.2098540377733537e-16, 1.2020936333088187e-05, -1.1719195644952896e-06, -7.306272461410759e-09, 4.954802742801512e-10], 80592778775.80573, 36336626351.96272, 7.815546405448113e+21], [[5.503765699185226e-09, -2.0368159066602156e-14, 7.007865516704569e-16, 7.401590730042956e-11, -1.0758809152883867e-10, -4.81242161435615e-18, 1.6920401134449408e-16, 7.252737601969932e-06, -1.4555276711017475e-06, -2.3666087924883646e-09, 5.473090522775584e-10], 132251515678.31416, 159734473832.25403, 4.300556552967842e+22], [[6.701336247754718e-10, -4.140927082261441e-14, 2.103700789533208e-15, -1.0596710236789472e-12, -2.5969309263339744e-10, -1.297746897643239e-17, 1.532571691389402e-16, 1.419625130943916e-05, -1.3099838106260078e-06, -8.470339938637353e-09, 5.196702325886083e-10], 791042092995.4928, 1092247252351.1487, 1.8187516531593238e+24], [[0.0, -2.528472615900415e-14, 2.5601074654579126e-15, 2.9889658956997054e-11, -1.7490232253263413e-10, -7.343144622651264e-18, 4.1017000342486986e-16, 1.2180516539498898e-05, -1.1822975264574355e-06, -7.183829721087023e-09, 5.394660836491704e-10], 902753307664.4551, 2023802360185.3489, 4.910739527590902e+24], [[-1.4431930822285825e-08, -5.7879963867094884e-15, 1.333091007692887e-15, 4.6333769462135915e-11, -7.413212979777405e-11, -7.091455283648153e-18, 1.0222372668005823e-16, 1.3919299277758973e-05, -1.1397425079760134e-06, -6.249449666562944e-09, 4.920691651787813e-10], 1061169801181.5931, 2548522318300.167, 7.62104735381384e+24], [[-4.3889464768617576e-10, -3.805730799635895e-14, 1.9659703985647853e-15, 3.943361892052465e-14, -2.470383784622537e-10, -9.095672647180157e-18, 9.261134150318414e-17, 1.4779558552074308e-05, -1.3614653793772294e-06, -8.436961149661554e-09, 5.172909869627147e-10], 1614745910139.3394, 2516966731425.28, 8.94252588141338e+24], [[-2.297660574494096e-09, -2.315704263293709e-14, 1.6481941203579822e-15, 1.4528093168754826e-11, -1.5698141685302512e-10, -7.393728105195658e-18, 3.705794043269641e-16, 1.273049022549281e-05, -1.1503113417717395e-06, -5.3802620027134585e-09, 4.920965821201998e-10], 1189763273736.5347, 2816667190184.078, 9.349150707791746e+24], [[1.2742246177199094e-09, -2.8956762826299593e-14, 2.081344914346912e-15, 4.2969483656135996e-13, -2.530938348877237e-10, -8.582969196629926e-18, 4.541476622381176e-16, 5.4483486117871946e-06, -1.2484280629416793e-06, -8.479686186800804e-09, 5.192524158745102e-10], 4011450341909.491, 6704726143040.695, 6.104508649877913e+25], [[-1.748960580390433e-08, -8.240526434193398e-15, 9.60834106015461e-16, 4.2558972499019323e-11, -1.170006937973782e-10, -7.07504025985086e-18, 1.2112961436086012e-16, 6.356297557773181e-06, -8.162882046645359e-07, -7.132478878944428e-09, 4.962787468787221e-10], 5624994778721.459, 10743788858565.543, 1.4706956529808076e+26], [[-1.6638458629198404e-08, -7.407864546842772e-15, 4.3979831208936726e-16, 1.461864865860414e-11, -2.7231370848290635e-11, -7.120725300141766e-18, 3.6413320132066966e-17, 1.4350962984620756e-05, -1.3592395540301384e-06, -1.083165389441327e-08, 4.966352533957505e-10], 7861930277217.786, 13886456571712.76, 2.5464362380189822e+26], [[0.0, -2.6132888139928544e-14, 1.7801748026899197e-15, 2.9889658956997054e-11, -1.7490232253263413e-10, -3.514961781124164e-18, 4.1017000342486986e-16, 1.2180516539498898e-05, -1.1822975264574355e-06, -7.183829721087023e-09, 6.277674501787851e-10], 7883385022052.292, 16064287461207.906, 3.2020909104224e+26], [[-9.623219042228788e-09, -3.694714501097514e-16, 6.992183231572208e-16, 3.417171143252262e-11, -1.1232708829790775e-10, -2.2159729609968245e-18, 1.798127083425831e-16, 1.030173081435665e-05, -8.106670093672922e-07, -6.961794364134922e-09, 4.913471754894498e-10], 9326571630868.26, 18927080769539.098, 4.4521932484237335e+26], [[-1.5241636903014968e-08, -5.486419373352908e-15, 1.1509465634250407e-15, 1.810210826203216e-11, -6.077305279419037e-11, -7.426419627295617e-18, 3.547358556399423e-17, 1.1976035111824201e-05, -1.1675132181743157e-06, -1.2107542681001608e-08, 4.3417665514220505e-10], 11673676038746.62, 20537204841148.973, 5.580514949449197e+26], [[6.379651699853873e-09, -2.082975695859308e-14, 5.36873220084729e-16, 7.522387325640692e-11, -1.072758663913975e-10, -4.725766476703843e-18, 1.553197705172534e-16, 5.759190249874686e-06, -1.9048418379785585e-06, -2.0433345047447944e-09, 9.238851033014819e-10], 13396090670389.477, 25698688785927.945, 8.398778505652747e+26], [[-1.8357042033391594e-08, -7.766830918783878e-15, 9.698507620165863e-16, 4.100424737457449e-11, -1.1609358651455322e-10, -7.162050822199992e-18, 1.1880159942611975e-16, 1.2355342481347824e-05, -1.1593356604721148e-06, -7.896976353754309e-09, 2.396609497483364e-10], 30821340486686.23, 55762966951966.234, 4.0594635126823224e+27]]



# Generation = [[[0.0, 7.276360151668641e-14, -2.37935144094506e-13, -2.750542686658241e-12, 0.0, -1.8753039399672114e-15, -1.975404473711345e-18, -1.3159396018522174e-06, 0.0, 0.0, 0.0], 1941903722349.2058, 1694220709286.0168, 3053553314930.461], [[0.0, 6.428971863272197e-14, -2.410182179458877e-13, -2.460888287321348e-12, 0.0, -1.8650344524941792e-15, -1.2571174325770867e-18, -1.1773605146098985e-06, -1.0933383594104783e-09, 0.0, 0.0], 1915909269887.1567, 1715023501402.2202, 3056159990323.2295], [[0.0, 4.845634566798112e-14, -2.1798857479022204e-13, -1.831702175553868e-12, 0.0, -1.7479047895158991e-15, 0.0, -8.048382194655715e-07, 0.0, 0.0, 0.0], 1787837540007.2336, 1828625718436.0403, 3080111996441.1035], [[0.0, 4.845634566798112e-14, -2.4426024183297556e-13, -1.8317021755538677e-12, 0.0, -1.843930111207982e-15, 0.0, -9.709254627656379e-07, 0.0, 0.0, 0.0], 1870792373111.648, 1782858319386.3472, 3092412980564.501], [[0.0, 4.8456345667981115e-14, -2.3396717523911295e-13, -1.8317021755538677e-12, 0.0, -1.8439301112079823e-15, 0.0, -8.583609523838375e-07, 0.0, 0.0, 0.0], 1857765534133.405, 1818014588115.0464, 3118450462008.4297], [[0.0, 4.8456345667981115e-14, -2.3396717523911295e-13, -1.8317021755538677e-12, 0.0, -1.8439301112079823e-15, 0.0, -8.583609523838375e-07, 0.0, 0.0, 0.0], 1857765534133.405, 1818014588115.0464, 3118450462008.4297], [[0.0, 4.7208547346787815e-14, -2.33967175239113e-13, -1.8317021755538677e-12, 0.0, -1.8439301112079823e-15, 0.0, -8.583609523838376e-07, 0.0, 0.0, 0.0], 1857765534133.405, 1818014588115.0464, 3118450462008.4297], [[0.0, -7.703937203406894e-15, -2.4695341378814566e-13, 0.0, 0.0, -1.6579218683602256e-15, 5.295254413466696e-18, 0.0, -1.0382282594029201e-08, 0.0, 0.0], 1669255781230.872, 1964660416173.941, 3133139463035.5513]]
# Generation = [[[0.0, -2.5226879286258498e-14, 1.711553025595155e-15, 4.45032212975167e-11, -1.4558928629020585e-10, -7.584106471585172e-18, 3.974022646586523e-16, 1.2506524204126208e-05, -1.183620652236583e-06, -7.1996173696563305e-09, 4.941266369252174e-10], 66709349077.890015, 39139817054.98453, 85836361409.50754], [[0.0, -2.4470567028388448e-14, 1.65670809726734e-15, 1.384525503912233e-11, -2.403421251213797e-10, -8.791837490237845e-18, 3.879038211568289e-16, 1.2718738540013407e-05, -1.2018118802884969e-06, -7.437789225594233e-09, 5.051947538162399e-10], 66175729801.13875, 41461351191.54491, 87784362052.34203], [[0.0, -2.5289384088989748e-14, 1.7198243932097579e-15, 4.688064526734878e-11, -1.7724067062516807e-10, -7.103407225524994e-18, 3.975889114983542e-16, 1.2143958124562008e-05, -1.1820921699403245e-06, -7.181304040853205e-09, 4.93243514386894e-10], 77947105590.26268, 21200124477.414772, 99147230067.67746], [[0.0, -3.704086887700809e-14, -7.886849370525534e-16, 1.3198955750285901e-11, -3.7406198491436866e-10, -4.282973665263188e-18, 1.0429821971614326e-16, 1.2247417390047256e-05, -1.1931588939396076e-06, -7.1154685190883895e-09, 4.986680760585865e-10], 66701434415.18591, 39281194871.30834, 105982629286.49426], [[0.0, -3.623175708872331e-14, -4.192403394226168e-16, 1.5069328635835034e-11, -1.3753441242676034e-10, -9.566803124805943e-18, 9.009499359463466e-17, 1.169421004609201e-05, -1.1672400288162373e-06, -7.0464380012135895e-09, 4.886421305265526e-10], 83342812699.48703, 22967642826.910423, 106310455526.39746], [[0.0, -2.4468126834941766e-14, 1.6466217815723871e-15, 1.3846108314944197e-11, -1.3462626664368288e-10, -8.751917607386404e-18, 3.8893405176426454e-16, 1.2718388847943767e-05, -1.2017869102414406e-06, -7.437556874573907e-09, 5.052641922653679e-10], 66156150634.65328, 42201996340.276375, 108358146974.92966], [[0.0, -3.135469649161985e-14, -5.930781105047288e-16, 1.3448685358809113e-11, -2.5447638002393963e-10, -6.4873239976026486e-18, 1.545299683799228e-16, 1.2168276057610818e-05, -1.1643726712473066e-06, -7.076783518462564e-09, 4.862962715144678e-10], 72578908597.06613, 38827238838.67964, 111406147435.74577], [[0.0, -3.1748050864806136e-14, 1.7534705821291206e-15, -6.274995001469001e-12, -2.7877415312581885e-10, -9.820178274694446e-18, 3.820051035091498e-16, 1.3068809345819597e-05, -1.2138221971091005e-06, -7.594001881568474e-09, 5.124736726954228e-10], 63971644606.73212, 62745135082.16658, 126716779688.8987], [[0.0, -2.3030599252911198e-14, 2.4441505911404586e-15, 5.1535389015335196e-11, -5.67991321967459e-11, -6.1622491322891306e-18, 4.0354731384909815e-16, 1.2729974323679364e-05, -1.1790995638663979e-06, -7.145448487181306e-09, 4.915144542082599e-10], 64169073879.80504, 65540835821.06087, 129709909700.8659], [[0.0, -3.1784831774648427e-14, -4.0589082741723367e-16, 1.1201815446516126e-11, -2.494521892653586e-10, 8.810517367307954e-18, 1.4198184055248882e-16, 1.1654602829905472e-05, -1.1966628566074783e-06, -7.376966086927687e-09, 5.021189820609735e-10], 118513725257.98994, 32531122708.65998, 151044847966.64993], [[0.0, -2.4331065410265942e-14, 1.5930084408781125e-15, 1.1035162601040649e-11, -2.41287592255413e-10, -1.447344994573976e-17, 1.8638471445976586e-16, 1.1445690055087276e-05, -1.2055267392949585e-06, -7.462082545780343e-09, 5.067834791111428e-10], 153715843105.72186, 63211976499.495804, 216927819605.21765], [[0.0, -3.647831507193108e-14, 2.104553337719984e-15, -1.718024692821063e-11, -1.8450960373389953e-10, 2.886797620506486e-16, 1.858846122876252e-17, 1.8457086357909555e-05, -1.6116077259402806e-06, -1.119966444454449e-08, 7.043786745597346e-10], 122041199267.10587, 203471512493.22702, 325512711760.3329], [[0.0, -3.3817274259621015e-14, -6.1184421829406e-16, 1.6791939493091477e-11, -3.511601090460186e-10, -3.5125932502345736e-17, 1.9950779483213944e-16, 1.1495948511604835e-05, -7.545930416354274e-07, -6.517001160172364e-09, 3.110594511988178e-10], 258855741132.71686, 265368721635.06183, 524224462767.7787], [[0.0, -4.3466081179075864e-14, -6.392394312465176e-16, 1.9814177816059293e-11, -3.747123727424997e-10, -1.227555163139104e-16, 3.113890445303783e-16, 9.138726320140516e-06, -1.004087477312392e-06, -6.296917115182225e-09, 4.112110020211967e-10], 363954789851.675, 198248719247.27396, 562203509098.949], [[0.0, -8.486117951603988e-15, -3.054892476774835e-16, 3.1343598506045506e-11, -4.1181902556687156e-10, -4.829089650443734e-16, 7.227267428558511e-16, 4.083045304186228e-06, -5.168206737923815e-07, -1.0877430869725058e-09, 1.6033744185972314e-10], 481013150267.13934, 353072380073.2084, 834085530340.3477], [[0.0, -5.287796829973702e-15, -2.669184202845165e-16, 1.0794171447714006e-10, -3.6928728966824463e-10, -4.488524806868851e-16, 7.657966181974166e-16, 3.546910967831979e-06, -4.4338539942384326e-07, -5.817262613693828e-10, 1.3575139978111274e-10], 471979347467.38214, 590166583068.2524, 1062145930535.6345], [[0.0, -1.8153138027799963e-14, 2.575027673416179e-15, 8.821305604021519e-12, -1.5967881565813e-10, -6.757712356037849e-18, 1.0271977936623775e-16, 1.6271378391186217e-05, -1.21328637046603e-06, -7.627538104814134e-09, 5.107482366743472e-10], 371397163814.119, 997307595389.1937, 1368704759203.3127], [[0.0, 2.605332786326335e-15, 2.304253764419238e-16, 7.076198688864232e-11, -1.5543032808680088e-10, -6.657915487833676e-16, 1.4689885034836676e-15, -1.0497647000830742e-06, -2.448075991295277e-07, 2.135113942325909e-09, 4.373991579591416e-11], 720401246795.3333, 933439410414.2428, 1653840657209.5762], [[0.0, -9.619871722709564e-16, -1.3016256772782992e-16, 1.011489407977017e-10, -5.515360075890071e-11, -8.591781259018532e-16, 1.5974468684940132e-15, -2.2465818057616183e-06, -1.9673681185680847e-07, 2.6154079450517265e-09, -3.0215122075052942e-12], 1189144179922.7102, 850051848934.2245, 2039196028856.9346], [[0.0, -3.082508998489967e-14, 2.1772400619990617e-15, -6.75985476404896e-12, -3.5840567531717876e-10, 2.2992355905760817e-16, -2.8921275621050754e-17, 2.6974334802400274e-05, -6.576446151989351e-07, -1.968555893424179e-08, 4.172706334402174e-10], 982283524479.0808, 1169498803917.277, 2151782328396.358]]
new = []
Generation.sort(key = lambda x: x[3])
print(Generation)
############# now that we have first generation, we take the best MATING_POOL_SIZE of them
# Generation = Generation[:MATING_POOL_SIZE]


# Generating new children 
for j in range(1):
    Generation2 = []
    Generated = 0
    done = 0
    # for i in range(0,int(GENERATION_SIZE/2)):
    while Generated < GENERATION_SIZE and done < 100:
        rand1 = random.randint(0,int(len(Generation))-1)
        rand2 = random.randint(0,int(len(Generation))-1)
        # while(rand1==rand2):
        #     rand2 = random.randint(0,int(len(Generation)))

        children = sex_two(Generation[rand1][0], Generation[rand2][0])
        new.append(mutation_two(children[0]))
        new.append(mutation_two(children[1]))
    # Adding them to Generation
    # for i, val in enumerate(new):
        # new.append(mutation(INITIAL_ARR, 0.5, 0.5))
        err = get_errors(SECRET_KEY_ID, children[0])
        if err[0]> 8*(10**10) and err[1] > 8*(10**10):
            Generation2.append([children[0], err[0], err[1], abs(err[0]**2+err[1]**2)])
            Generated = Generated+1
        err = get_errors(SECRET_KEY_ID, children[1])
        if err[0]> 8*(10**10) and err[1] > 8*(10**10):
            Generation2.append([children[1], err[0], err[1], abs(err[0]**2+err[1]**2)])
            Generated = Generated+1
        done=done+2
    if done >=60:
        print("1")
        print(Generation)
        print("2")
        print(Generation2)
        # print(get_errors(SECRET_KEY_ID, GENERATION[i]))
    Generation.sort(key = lambda x: x[3])
    Generation = Generation[:OLD_GENERATION]
    new = []
    Generation2.sort(key = lambda x: x[3])
    Generation2 = Generation2[:GENERATION_SIZE-OLD_GENERATION]
    for val in Generation2:
        Generation.append(val)
    print(str(j)+ " generation:")
    Generation.sort(key = lambda x: x[3])
    print(Generation)
# print(str(random.randint(0,9)) + "  " + str(random.randint(0,9)))
# print(GENERATION)
# print(sex(GENERATION[random.randint(0,9)], GENERATION[random.randint(0,9)], 0,0))









